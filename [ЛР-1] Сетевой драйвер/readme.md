# [ЛР-1] Сетевой драйвер

### Введение
Ввиду отсутствия BBB – вся работа происходит по полной аналогии на WSL2 Ubuntu 22.05. 
В файлах репозитория прикреплены результаты работы. Ввиду виртуализации ОС некоторые настройки отличаются.

### Получение сетевого драйвера
Для начала требуется оценить текущий сетевой драйвер. Сделаем это утилитой ```ip link show```. Текущий сетевой адаптер нашего интернет-соединения ```eth0``` – характерный для ОС Ubuntu:

![image](https://github.com/user-attachments/assets/645fe26d-fb5c-49f0-92b6-2cc81629e65b)

Управляющий драйвер:  ```netvsc_drv.c``` – от компании Microsoft
Его исходный код можно найти по адресу: https://git.shtrih-m.ru/amednyy/mainline_linux/-/blob/v3.0.93/drivers/staging/hv/netvsc_drv.c
Скачивать весь исходный код ядра не будет – скопируем только код требуемого драйвера, оптимизировав тем самым процесс разработки.

### Подготовка к обновлению
Вставим код драйвера, как видим, его структура стандартная:

![image](https://github.com/user-attachments/assets/23699364-dd29-44fc-b121-a84a79113adb)

Кроме того продублируем файл с названиями ```netvsc_drv.c``` и ```netvsc_drv2.c``` – будем патчить их относительно друг друга.

В данном драйвере поддерживается своя система логгирования:
```pr_info("initializing....");```
Не будем нарушать стиль кода и будем использовать для релизации её.

### Обновление
Ввиду разработки на WSL2 номера прерываний не указываются, пишем вызовы которые работают с vmbus и залоггируем их.
Сгенерируем изменения и преобразуем в формат ```.patch``` их утилитой ```diff```:

![image](https://github.com/user-attachments/assets/1e525865-cfb8-4c7b-b4a3-87c4772acf14)

Патч и исходный код прикреплены в репозитории.
Изменения собраны с помощью makefile.
